@startuml
title LNURL Pay - Invoice Generation Failure

actor Wallet as wallet
participant "LNURL HTTP Service" as lnurl
participant "LN Node" as lnnode

== Get LNURL Offer ==
activate wallet
wallet -> lnurl++: GET /offers/{id}
note right: Request LNURL offer details
lnurl -> lnurl: Retrieve offer from storage
return LNURL offer (callback URL, metadata, amounts)

wallet -> wallet: Parse offer and prepare invoice request

== Request Lightning Invoice (Fails) ==
wallet -> lnurl++: GET /offers/{id}/invoice?amount={sats}
note right: Request invoice via callback URL

lnurl -> lnnode++: get_invoice(offer, amount)
note right: Direct connection to LN node
lnnode --> lnurl: Error: Unable to generate invoice
note left: Node offline, misconfigured,\nor other error
deactivate lnnode

lnurl --> wallet: HTTP 500 Internal Server Error
note left: {"error": "Unable to generate invoice"}

deactivate wallet

@enduml